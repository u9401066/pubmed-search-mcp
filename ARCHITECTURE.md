# PubMed Search MCP - ç³»çµ±æ¶æ§‹æ–‡ä»¶

> **Architecture Documentation** | ç³»çµ±æ¶æ§‹è¨­è¨ˆèªªæ˜

## ğŸ“‹ ç›®éŒ„

- [ç³»çµ±ç¸½è¦½](#ç³»çµ±ç¸½è¦½)
- [DDD é ˜åŸŸé©…å‹•è¨­è¨ˆ](#ddd-é ˜åŸŸé©…å‹•è¨­è¨ˆ)
- [MCP å·¥å…·åˆ†å±¤](#mcp-å·¥å…·åˆ†å±¤)
- [Pipeline æŒä¹…åŒ–èˆ‡æ’ç¨‹](#pipeline-æŒä¹…åŒ–èˆ‡æ’ç¨‹)
- [HTTPS éƒ¨ç½²æ¶æ§‹](#https-éƒ¨ç½²æ¶æ§‹)
- [è³‡æ–™æµç¨‹](#è³‡æ–™æµç¨‹)
- [å…§éƒ¨æ©Ÿåˆ¶](#å…§éƒ¨æ©Ÿåˆ¶)

---

## ç³»çµ±ç¸½è¦½

PubMed Search MCP æ˜¯ä¸€å€‹åŸºæ–¼ **Domain-Driven Design (DDD)** çš„ MCP ä¼ºæœå™¨ï¼Œå°ˆç‚º AI Agent æä¾›æ™ºæ…§æ–‡ç»ç ”ç©¶èƒ½åŠ›ã€‚

### è¨­è¨ˆåŸå‰‡

| åŸå‰‡ | èªªæ˜ |
|------|------|
| **Agent-First** | è¼¸å‡ºæ ¼å¼å„ªåŒ–ç‚ºæ©Ÿå™¨æ±ºç­–ï¼Œéäººé¡é–±è®€ |
| **Task-Oriented** | å·¥å…·ä»¥ç ”ç©¶ä»»å‹™ç‚ºå–®ä½ï¼Œè€Œéåº•å±¤ API |
| **Domain-Driven** | ä»¥æ–‡ç»ç ”ç©¶é ˜åŸŸçŸ¥è­˜ç‚ºæ ¸å¿ƒå»ºæ¨¡ |
| **Context-Aware** | é€é Session ç¶­æŒç ”ç©¶ç‹€æ…‹ |

---

## DDD é ˜åŸŸé©…å‹•è¨­è¨ˆ

### ç›®éŒ„çµæ§‹

```
src/pubmed_search/
â”œâ”€â”€ mcp/
â”‚   â”œâ”€â”€ tools/                    # Application Layer - MCP å·¥å…·
â”‚   â”‚   â”œâ”€â”€ discovery.py          # æ¢ç´¢å‹å·¥å…· (search, related, citing)
â”‚   â”‚   â”œâ”€â”€ strategy.py           # ç­–ç•¥å‹å·¥å…· (generate_queries, expand)
â”‚   â”‚   â”œâ”€â”€ pico.py               # PICO è§£æ
â”‚   â”‚   â”œâ”€â”€ merge.py              # çµæœåˆä½µ
â”‚   â”‚   â”œâ”€â”€ export.py             # åŒ¯å‡ºå·¥å…·
â”‚   â”‚   â”œâ”€â”€ citation_tree.py      # å¼•ç”¨ç¶²çµ¡è¦–è¦ºåŒ–
â”‚   â”‚   â””â”€â”€ _common.py            # å…±ç”¨å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ session_tools.py          # Session ç®¡ç† (å…§éƒ¨)
â”‚   â””â”€â”€ server.py                 # MCP Server å…¥å£
â”‚
â”œâ”€â”€ entrez/                       # Infrastructure Layer - NCBI API
â”‚   â”œâ”€â”€ searcher.py               # æ–‡ç»æœå°‹å™¨
â”‚   â”œâ”€â”€ fetcher.py                # æ–‡ç« è©³æƒ…ç²å–
â”‚   â””â”€â”€ mesh.py                   # MeSH è©å½™æŸ¥è©¢
â”‚
â”œâ”€â”€ exports/                      # Infrastructure Layer - åŒ¯å‡ºæ ¼å¼
â”‚   â”œâ”€â”€ ris.py                    # RIS æ ¼å¼
â”‚   â”œâ”€â”€ bibtex.py                 # BibTeX æ ¼å¼
â”‚   â”œâ”€â”€ csv_export.py             # CSV æ ¼å¼
â”‚   â””â”€â”€ medline.py                # MEDLINE æ ¼å¼
â”‚
â”œâ”€â”€ domain/                       # Domain Layer - é ˜åŸŸæ¨¡å‹
â”‚   â”œâ”€â”€ entities/
â”‚   â”‚   â”œâ”€â”€ article.py            # æ–‡ç« å¯¦é«”
â”‚   â”‚   â””â”€â”€ search_result.py      # æœå°‹çµæœ
â”‚   â””â”€â”€ value_objects/
â”‚       â”œâ”€â”€ pmid.py               # PMID å€¼ç‰©ä»¶
â”‚       â””â”€â”€ query.py              # æŸ¥è©¢å€¼ç‰©ä»¶
â”‚
â”œâ”€â”€ session.py                    # Session ç®¡ç† (å…§éƒ¨æ©Ÿåˆ¶)
â””â”€â”€ client.py                     # Python Client API
```

### åˆ†å±¤æ¶æ§‹ (Onion Architecture)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              Presentation Layer                              â”‚
â”‚                         (MCP Protocol / HTTP API)                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              Application Layer                               â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                   â”‚           MCP Tools                  â”‚                   â”‚
â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â” â”‚                   â”‚
â”‚                   â”‚  â”‚Discoveryâ”‚  â”‚Strategy â”‚  â”‚Exportâ”‚ â”‚                   â”‚
â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜ â”‚                   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                               Domain Layer                                   â”‚
â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚                   â”‚         Domain Services              â”‚                   â”‚
â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚                   â”‚  â”‚   Search   â”‚  â”‚ Citation Tree â”‚  â”‚                   â”‚
â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚                   â”‚         Domain Entities              â”‚                   â”‚
â”‚                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”‚                   â”‚
â”‚                   â”‚  â”‚Article â”‚  â”‚ Query  â”‚  â”‚Sessionâ”‚  â”‚                   â”‚
â”‚                   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                   â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            Infrastructure Layer                              â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚     â”‚ NCBI Entrez  â”‚    â”‚   Exports    â”‚    â”‚    Cache     â”‚               â”‚
â”‚     â”‚     API      â”‚    â”‚  (RIS, Bib)  â”‚    â”‚   (Memory)   â”‚               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## MCP å·¥å…·åˆ†å±¤

### å·¥å…·åˆ†é¡ (14 å€‹å·¥å…·)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            MCP Tools (14)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Discovery Tools (8)                             â”‚    â”‚
â”‚  â”‚  æ¢ç´¢å‹å·¥å…· - æœå°‹ã€ç™¼ç¾ã€æ¢ç´¢æ–‡ç»                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ search_literature      æœå°‹ PubMed æ–‡ç»                           â”‚    â”‚
â”‚  â”‚  â€¢ find_related_articles  å°‹æ‰¾ä¸»é¡Œç›¸ä¼¼æ–‡ç«  (PubMed algorithm)         â”‚    â”‚
â”‚  â”‚  â€¢ find_citing_articles   å°‹æ‰¾å¼•ç”¨æ­¤æ–‡çš„è«–æ–‡ (Forward â¡ï¸)             â”‚    â”‚
â”‚  â”‚  â€¢ get_article_references å–å¾—æ­¤æ–‡çš„åƒè€ƒæ–‡ç» (Backward â¬…ï¸)            â”‚    â”‚
â”‚  â”‚  â€¢ fetch_article_details  å–å¾—æ–‡ç« å®Œæ•´è³‡è¨Š                            â”‚    â”‚
â”‚  â”‚  â€¢ get_citation_metrics   å–å¾—å¼•ç”¨æŒ‡æ¨™ (iCite RCR/Percentile)        â”‚    â”‚
â”‚  â”‚  â€¢ build_citation_tree    å»ºæ§‹å¼•ç”¨ç¶²çµ¡æ¨¹ (6 ç¨®æ ¼å¼)                   â”‚    â”‚
â”‚  â”‚  â€¢ suggest_citation_tree  è©•ä¼°æ˜¯å¦å€¼å¾—å»ºæ§‹å¼•ç”¨æ¨¹                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      Strategy Tools (4)                              â”‚    â”‚
â”‚  â”‚  ç­–ç•¥å‹å·¥å…· - æœå°‹ç­–ç•¥ç”Ÿæˆã€æ“´å±•ã€åˆä½µ                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ parse_pico               è§£æ PICO è‡¨åºŠå•é¡Œ (æœå°‹å…¥å£)             â”‚    â”‚
â”‚  â”‚  â€¢ generate_search_queries  ç”¢ç”Ÿå¤šå€‹æœå°‹ç­–ç•¥ (ESpell + MeSH)          â”‚    â”‚
â”‚  â”‚  â€¢ merge_search_results     åˆä½µå»é‡æœå°‹çµæœ                          â”‚    â”‚
â”‚  â”‚  â€¢ expand_search_queries    æ“´å±•æœå°‹ç­–ç•¥                              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                       Export Tools (3)                               â”‚    â”‚
â”‚  â”‚  åŒ¯å‡ºå‹å·¥å…· - åŒ¯å‡ºå¼•ç”¨ã€å–å¾—å…¨æ–‡é€£çµ                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ prepare_export           åŒ¯å‡ºå¼•ç”¨æ ¼å¼ (RIS/BibTeX/CSV/MEDLINE)    â”‚    â”‚
â”‚  â”‚  â€¢ get_article_fulltext_links  å–å¾—å…¨æ–‡é€£çµ (PMC/DOI)                â”‚    â”‚
â”‚  â”‚  â€¢ analyze_fulltext_access  åˆ†æé–‹æ”¾å–ç”¨å¯ç”¨æ€§                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Citation Discovery å·¥å…·é—œä¿‚

```
                            æ‰¾åˆ°é‡è¦è«–æ–‡ (PMID)
                                    â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                       â”‚                       â”‚
            â–¼                       â–¼                       â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚find_related_  â”‚      â”‚find_citing_   â”‚      â”‚get_article_   â”‚
    â”‚articles       â”‚      â”‚articles       â”‚      â”‚references     â”‚
    â”‚               â”‚      â”‚               â”‚      â”‚               â”‚
    â”‚ ç›¸ä¼¼æ€§æœå°‹    â”‚      â”‚ Forward â¡ï¸    â”‚      â”‚ Backward â¬…ï¸   â”‚
    â”‚ PubMed æ¼”ç®—æ³• â”‚      â”‚ è¢«å¼•ç”¨æ–‡ç«     â”‚      â”‚ åƒè€ƒæ–‡ç»      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                       â”‚                       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚build_citation_  â”‚
                          â”‚tree             â”‚
                          â”‚                 â”‚
                          â”‚ BFS éæ­·ç¶²çµ¡    â”‚
                          â”‚ 6 ç¨®è¼¸å‡ºæ ¼å¼    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Pipeline æŒä¹…åŒ–èˆ‡æ’ç¨‹

> **Status**: è¨­è¨ˆå®Œæˆï¼Œå°šæœªå¯¦ä½œ
> **è©³ç´°è¨­è¨ˆæ–‡ä»¶**: [docs/PIPELINE_PERSISTENCE_DESIGN.md](docs/PIPELINE_PERSISTENCE_DESIGN.md)

### è¨­è¨ˆèƒŒæ™¯

Pipeline ç³»çµ±ï¼ˆv0.4.0ï¼‰æä¾› DAG åŸ·è¡Œå¼•æ“å’Œ 4 å€‹æ¨¡æ¿ï¼ˆpico, comprehensive, exploration, gene_drugï¼‰ï¼Œ
ä½†ç›®å‰æ˜¯**å®Œå…¨ç„¡ç‹€æ…‹çš„** â€” æ¯æ¬¡éœ€è¦ inline å‚³å…¥é…ç½®ï¼Œç„¡æ³•ä¿å­˜ã€é‡è¤‡ä½¿ç”¨ã€æˆ–å®šæœŸåŸ·è¡Œã€‚

Pipeline æŒä¹…åŒ–æ“´å±•åˆ†ç‚º 4 å€‹ Phaseï¼š

| Phase | åŠŸèƒ½ | ç‹€æ…‹ |
|-------|------|------|
| 1 | Pipeline CRUDï¼ˆsave/list/load/deleteï¼‰ | ğŸ”² è¦åŠƒä¸­ |
| 2 | å¤–éƒ¨è¼‰å…¥ï¼ˆURL / æª”æ¡ˆè·¯å¾‘ï¼‰ | ğŸ”² è¦åŠƒä¸­ |
| 3 | åŸ·è¡Œæ­·å²èˆ‡ Diff | ğŸ”² è¦åŠƒä¸­ |
| 4 | æ’ç¨‹æœå°‹ï¼ˆasyncio tick loopï¼‰ | ğŸ”² è¦åŠƒä¸­ |

### å…©è·¯ç”±æ¨¡å‹

```
ä½¿ç”¨è€…å•é¡Œ
    â”‚
    â”œâ”€â”€ ç°¡å–®æŸ¥è©¢ â”€â”€â”€â”€â”€â”€â†’ unified_search(query="...")
    â”‚                      â†’ å³æ™‚å›å‚³çµæœ
    â”‚
    â””â”€â”€ è¤‡é›œ/é‡è¤‡éœ€æ±‚ â”€â”€â†’ save_pipeline(name, config)
                           â†’ unified_search(pipeline="saved:name")
                           â†’ schedule_pipeline(name, cron)
                           â†’ load_pipeline / list_pipelines / delete_pipeline
```

**é—œéµåŸå‰‡**ï¼š`unified_search` æ˜¯å”¯ä¸€çš„æœå°‹åŸ·è¡Œå…¥å£ã€‚Pipeline å·¥å…·åªåš CRUD + æ’ç¨‹ç®¡ç†ï¼Œä¸ç›´æ¥åŸ·è¡Œæœå°‹ã€‚

### MCP å·¥å…·ï¼ˆ6 å€‹ç¨ç«‹å·¥å…·ï¼‰

| å·¥å…· | ç”¨é€” | Phase |
|------|------|-------|
| `save_pipeline` | ä¿å­˜ pipeline é…ç½®ï¼ˆupsertï¼Œæ”¯æ´ scope é¸æ“‡ï¼‰ | 1 |
| `list_pipelines` | åˆ—èˆ‰å·²å­˜ pipelineï¼ˆåˆä½µ workspace + globalï¼‰ | 1 |
| `load_pipeline` | è¼‰å…¥ pipelineï¼ˆname / URL / pathï¼‰ | 1 |
| `delete_pipeline` | åˆªé™¤ pipeline + æ­·å² + æ’ç¨‹ | 1 |
| `get_pipeline_history` | æŸ¥è©¢åŸ·è¡Œæ­·å²èˆ‡ diff | 3 |
| `schedule_pipeline` | æ’ç¨‹/è§£é™¤æ’ç¨‹/æŸ¥çœ‹æ’ç¨‹ | 4 |

### DDD åˆ†å±¤

```
Presentation â”€â”€â”€ tools/pipeline_tools.py (6 MCP tools)
                 resources.py (pipeline://saved/{name}, pipeline://templates/{name})
       â”‚
Application â”€â”€â”€â”€ pipeline/store.py     (PipelineStore: CRUD + é›™å±¤ scope)
                 pipeline/scheduler.py  (PipelineScheduler: tick loop)
                 pipeline/executor.py   (å·²æœ‰, æ–°å¢ run_and_store)
       â”‚
Domain â”€â”€â”€â”€â”€â”€â”€â”€  entities/pipeline.py  (æ–°å¢ PipelineMeta, PipelineRun, ScheduleEntry)
       â”‚
Infrastructure
       â”‚
       â”œâ”€ Workspace scope (å„ªå…ˆï¼Œå¯ git è¿½è¹¤)ï¼š
       â”‚    {workspace}/.pubmed-search/pipelines/{name}.yaml
       â”‚    {workspace}/.pubmed-search/pipeline_runs/{name}/*.json
       â”‚
       â””â”€ Global scope (fallbackï¼Œè·¨å°ˆæ¡ˆ)ï¼š
            ~/.pubmed-search-mcp/pipelines/{name}.yaml
            ~/.pubmed-search-mcp/pipeline_runs/{name}/*.json
            ~/.pubmed-search-mcp/schedules.json
```

### é›™å±¤å„²å­˜æ¨¡å‹

> **æ±ºç­– D7**ï¼šæ¡ç”¨ workspace + global é›™å±¤å„²å­˜ã€‚

| Scope | è·¯å¾‘ | ç”¨é€” | å¯ git è¿½è¹¤ |
|-------|------|------|------------|
| **workspace** | `{workspace}/.pubmed-search/` | å°ˆæ¡ˆç´šæœå°‹ç­–ç•¥ï¼Œå¯åˆ†äº«çµ¦å”ä½œè€… | âœ… |
| **global** | `~/.pubmed-search-mcp/` | å€‹äººé€šç”¨ç­–ç•¥ï¼Œè·¨å°ˆæ¡ˆå¯ç”¨ | âŒ |

è§£æé †åºï¼š`load(name)` â†’ workspace å„ªå…ˆï¼Œæ‰¾ä¸åˆ°å‰‡ global fallbackã€‚
`save_pipeline(scope="auto")` é è¨­å­˜ workspaceï¼ˆè‹¥æœ‰ï¼‰ï¼Œå¦å‰‡ globalã€‚
æ’ç¨‹åƒ…åœ¨ global scopeï¼ˆéœ€è·¨ workspace é‹ä½œï¼‰ã€‚

### æ’ç¨‹æ©Ÿåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP Server Lifespan             â”‚
â”‚                                  â”‚
â”‚  startup:                        â”‚
â”‚    load schedules.json           â”‚
â”‚    start _tick_loop()            â”‚
â”‚                                  â”‚
â”‚  _tick_loop (æ¯60ç§’):            â”‚
â”‚    for schedule in schedules:    â”‚
â”‚      if should_run(now):         â”‚
â”‚        asyncio.create_task(      â”‚
â”‚          execute_and_store())    â”‚
â”‚        update next_run           â”‚
â”‚                                  â”‚
â”‚  shutdown:                       â”‚
â”‚    save schedules.json           â”‚
â”‚    cancel background tasks       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®‰å…¨ç´„æŸ**ï¼šæœ€å°é–“éš” 1 å°æ™‚ã€åŒæ™‚æœ€å¤š 5 æ’ç¨‹ã€åŸ·è¡Œè¶…æ™‚ 5 åˆ†é˜ã€URL ç™½åå–®ã€‚

---

## HTTPS éƒ¨ç½²æ¶æ§‹

### æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           HTTPS Deployment                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                     â”‚
â”‚   â”‚      Client       â”‚                                                     â”‚
â”‚   â”‚    (AI Agent)     â”‚                                                     â”‚
â”‚   â”‚                   â”‚                                                     â”‚
â”‚   â”‚ â€¢ Claude Desktop  â”‚                                                     â”‚
â”‚   â”‚ â€¢ VS Code Copilot â”‚                                                     â”‚
â”‚   â”‚ â€¢ Custom Client   â”‚                                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                     â”‚
â”‚             â”‚                                                                â”‚
â”‚             â”‚ HTTPS (TLS 1.2/1.3)                                           â”‚
â”‚             â”‚ Port 443                                                       â”‚
â”‚             â–¼                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                     Nginx Reverse Proxy                          â”‚       â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚       â”‚
â”‚   â”‚  â”‚                    Security Features                        â”‚ â”‚       â”‚
â”‚   â”‚  â”‚                                                             â”‚ â”‚       â”‚
â”‚   â”‚  â”‚  âœ… TLS Termination (SSL Certificates)                      â”‚ â”‚       â”‚
â”‚   â”‚  â”‚  âœ… Rate Limiting (30 req/s per IP)                         â”‚ â”‚       â”‚
â”‚   â”‚  â”‚  âœ… Security Headers                                        â”‚ â”‚       â”‚
â”‚   â”‚  â”‚     â€¢ X-Frame-Options: SAMEORIGIN                           â”‚ â”‚       â”‚
â”‚   â”‚  â”‚     â€¢ X-Content-Type-Options: nosniff                       â”‚ â”‚       â”‚
â”‚   â”‚  â”‚     â€¢ X-XSS-Protection: 1; mode=block                       â”‚ â”‚       â”‚
â”‚   â”‚  â”‚  âœ… SSE Optimization                                        â”‚ â”‚       â”‚
â”‚   â”‚  â”‚     â€¢ 24h timeout for long-lived connections                â”‚ â”‚       â”‚
â”‚   â”‚  â”‚     â€¢ Buffering disabled                                    â”‚ â”‚       â”‚
â”‚   â”‚  â”‚                                                             â”‚ â”‚       â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                   â”‚                                          â”‚
â”‚                                   â”‚ HTTP (internal only)                     â”‚
â”‚                                   â”‚ Port 8765                                â”‚
â”‚                                   â–¼                                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚              â”‚           PubMed Search MCP Server          â”‚                  â”‚
â”‚              â”‚                                             â”‚                  â”‚
â”‚              â”‚  Endpoints:                                 â”‚                  â”‚
â”‚              â”‚  â€¢ /          Root                          â”‚                  â”‚
â”‚              â”‚  â€¢ /sse       SSE Connection (MCP)          â”‚                  â”‚
â”‚              â”‚  â€¢ /messages  POST messages (MCP)           â”‚                  â”‚
â”‚              â”‚  â€¢ /exports   Export files list             â”‚                  â”‚
â”‚              â”‚  â€¢ /download  Download export file          â”‚                  â”‚
â”‚              â”‚                                             â”‚                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Docker Compose æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        docker-compose.https.yml                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Network: pubmed-mcp-network                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚   â”‚  â”‚     nginx           â”‚      â”‚     pubmed-mcp      â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  (nginx:alpine)     â”‚      â”‚  (custom build)     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚                     â”‚      â”‚                     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  Ports:             â”‚      â”‚  Expose:            â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ 443:443 (HTTPS)  â”‚â”€â”€â”€â”€â”€â”€â”‚  â€¢ 8765 (internal)  â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ 80:80 (redirect) â”‚      â”‚                     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚                     â”‚      â”‚  Environment:       â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  Volumes:           â”‚      â”‚  â€¢ NCBI_EMAIL       â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ nginx.conf       â”‚      â”‚  â€¢ NCBI_API_KEY     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ ssl/             â”‚      â”‚                     â”‚               â”‚   â”‚
â”‚   â”‚  â”‚                     â”‚      â”‚  Healthcheck:       â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  Depends on:        â”‚      â”‚  â€¢ curl localhost   â”‚               â”‚   â”‚
â”‚   â”‚  â”‚  â€¢ pubmed-mcp       â”‚      â”‚                     â”‚               â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### SSL æ†‘è­‰çµæ§‹

```
nginx/
â””â”€â”€ ssl/
    â”œâ”€â”€ ca.crt          # CA æ†‘è­‰ (éœ€åŠ å…¥ç³»çµ±ä¿¡ä»»)
    â”œâ”€â”€ ca.key          # CA ç§é‘° (å‹¿å¤–æ´©)
    â”œâ”€â”€ server.crt      # ä¼ºæœå™¨æ†‘è­‰
    â””â”€â”€ server.key      # ä¼ºæœå™¨ç§é‘° (å‹¿å¤–æ´©)
```

### Endpoints å°ç…§è¡¨

| External (HTTPS) | Internal (HTTP) | Description |
|------------------|-----------------|-------------|
| `https://localhost/` | `http://pubmed-mcp:8765/` | MCP Server root |
| `https://localhost/sse` | `http://pubmed-mcp:8765/sse` | SSE connection |
| `https://localhost/messages` | `http://pubmed-mcp:8765/messages` | MCP POST |
| `https://localhost/health` | `http://pubmed-mcp:8765/` | Health check |
| `https://localhost/exports` | `http://pubmed-mcp:8765/exports` | Export list |

---

## è³‡æ–™æµç¨‹

### æœå°‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Search Data Flow                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   AI Agent                                                                  â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”‚ search_literature(query="remimazolam sedation")                      â”‚
â”‚      â–¼                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                   â”‚
â”‚   â”‚    MCP Server       â”‚                                                   â”‚
â”‚   â”‚   (discovery.py)    â”‚                                                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚              â”‚                                                               â”‚
â”‚              â”‚ 1. Check cache                                               â”‚
â”‚              â–¼                                                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     Cache Hit?                                    â”‚
â”‚   â”‚    Session Cache    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                  â”‚
â”‚              â”‚ No                                        â”‚                  â”‚
â”‚              â–¼                                           â”‚                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚                  â”‚
â”‚   â”‚  LiteratureSearcher â”‚                                â”‚                  â”‚
â”‚   â”‚     (entrez/)       â”‚                                â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                  â”‚
â”‚              â”‚                                           â”‚                  â”‚
â”‚              â”‚ 2. Entrez.esearch()                       â”‚                  â”‚
â”‚              â”‚ 3. Entrez.efetch()                        â”‚                  â”‚
â”‚              â–¼                                           â”‚                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚                  â”‚
â”‚   â”‚     NCBI Entrez     â”‚                                â”‚                  â”‚
â”‚   â”‚        API          â”‚                                â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚                  â”‚
â”‚              â”‚                                           â”‚                  â”‚
â”‚              â”‚ XML Response                              â”‚                  â”‚
â”‚              â–¼                                           â”‚                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚                  â”‚
â”‚   â”‚   Parse & Format    â”‚                                â”‚                  â”‚
â”‚   â”‚   SearchResult[]    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                   â”‚
â”‚              â”‚                                                               â”‚
â”‚              â”‚ 4. Cache results                                             â”‚
â”‚              â”‚ 5. Format output                                             â”‚
â”‚              â–¼                                                               â”‚
â”‚   AI Agent receives formatted results                                       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Citation Tree å»ºæ§‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Citation Tree Data Flow                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   build_citation_tree(pmid="12345678", depth=2, direction="both")           â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â–¼                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚                     BFS Traversal                              â”‚         â”‚
â”‚   â”‚                                                                â”‚         â”‚
â”‚   â”‚   Level 0: [12345678]  (seed article)                         â”‚         â”‚
â”‚   â”‚      â”‚                                                         â”‚         â”‚
â”‚   â”‚      â”œâ”€â”€ get_citing_articles()  â”€â”€â–º [A, B, C]                 â”‚         â”‚
â”‚   â”‚      â””â”€â”€ get_article_references() â”€â”€â–º [X, Y, Z]               â”‚         â”‚
â”‚   â”‚      â”‚                                                         â”‚         â”‚
â”‚   â”‚   Level 1: [A, B, C, X, Y, Z]                                 â”‚         â”‚
â”‚   â”‚      â”‚                                                         â”‚         â”‚
â”‚   â”‚      â”œâ”€â”€ get_citing_articles() for each  â”€â”€â–º [...]            â”‚         â”‚
â”‚   â”‚      â””â”€â”€ get_article_references() for each â”€â”€â–º [...]          â”‚         â”‚
â”‚   â”‚      â”‚                                                         â”‚         â”‚
â”‚   â”‚   Level 2: [...]  (depth reached, stop)                       â”‚         â”‚
â”‚   â”‚                                                                â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â”‚ Nodes: [{pmid, title, year, ...}, ...]                               â”‚
â”‚      â”‚ Edges: [{source, target, type}, ...]                                 â”‚
â”‚      â–¼                                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚                   Format Converter                             â”‚         â”‚
â”‚   â”‚                                                                â”‚         â”‚
â”‚   â”‚   output_format="mermaid"  â”€â”€â–º _to_mermaid()                  â”‚         â”‚
â”‚   â”‚   output_format="cytoscape" â”€â”€â–º _to_cytoscape()               â”‚         â”‚
â”‚   â”‚   output_format="graphml"  â”€â”€â–º _to_graphml()                  â”‚         â”‚
â”‚   â”‚   ...                                                          â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚      â”‚                                                                       â”‚
â”‚      â–¼                                                                       â”‚
â”‚   Formatted graph data (JSON/XML/Mermaid)                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…§éƒ¨æ©Ÿåˆ¶

### å° Agent é€æ˜çš„æ©Ÿåˆ¶

é€™äº›æ©Ÿåˆ¶è‡ªå‹•é‹ä½œï¼ŒAgent ç„¡éœ€ç®¡ç†ï¼š

| æ©Ÿåˆ¶ | èªªæ˜ | å¯¦ä½œä½ç½® |
|------|------|----------|
| **Session** | è‡ªå‹•å»ºç«‹ã€è‡ªå‹•åˆ‡æ›ï¼Œç¶­æŒæœå°‹ä¸Šä¸‹æ–‡ | `session.py` |
| **Cache** | æœå°‹çµæœè‡ªå‹•å¿«å–ï¼Œé¿å…é‡è¤‡ API å‘¼å« | `_common.py` |
| **Rate Limit** | è‡ªå‹•éµå®ˆ NCBI API é™åˆ¶ (0.34s/0.1s with key) | `entrez/` |
| **MeSH Lookup** | `generate_search_queries()` è‡ªå‹•æŸ¥è©¢ MeSH | `strategy.py` |
| **ESpell** | è‡ªå‹•æ‹¼å­—æ ¡æ­£ (`remifentanyl` â†’ `remifentanil`) | `strategy.py` |
| **Query Analysis** | åˆ†æ PubMed å¯¦éš›è§£è®€æ–¹å¼ | `strategy.py` |

### Rate Limiting

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           NCBI Rate Limits                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Without API Key:                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  â€¢ 3 requests per second                                         â”‚       â”‚
â”‚   â”‚  â€¢ 0.34 second delay between requests                            â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚   With API Key (NCBI_API_KEY):                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚  â€¢ 10 requests per second                                        â”‚       â”‚
â”‚   â”‚  â€¢ 0.1 second delay between requests                             â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚   Implementation:                                                            â”‚
â”‚   â€¢ time.sleep() between API calls                                          â”‚
â”‚   â€¢ Automatic retry on rate limit errors                                    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç›¸é—œæ–‡ä»¶

| æ–‡ä»¶ | èªªæ˜ |
|------|------|
| [README.md](README.md) | å¿«é€Ÿé–‹å§‹ã€åŠŸèƒ½ç¸½è¦½ |
| [DEPLOYMENT.md](DEPLOYMENT.md) | éƒ¨ç½²æŒ‡å—ã€å®¢æˆ¶ç«¯é…ç½® |
| [CHANGELOG.md](CHANGELOG.md) | ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„ |
| [ROADMAP.md](ROADMAP.md) | é–‹ç™¼è·¯ç·šåœ– |
| [docs/PIPELINE_PERSISTENCE_DESIGN.md](docs/PIPELINE_PERSISTENCE_DESIGN.md) | Pipeline æŒä¹…åŒ–èˆ‡æ’ç¨‹è©³ç´°è¨­è¨ˆ |

---

## æŠ€è¡“æ±ºç­–è¨˜éŒ„ (ADR)

### ADR-001: é¸æ“‡ DDD æ¶æ§‹

**Context**: éœ€è¦ä¸€å€‹å¯ç¶­è­·ã€å¯æ“´å±•çš„æ¶æ§‹ä¾†è™•ç†æ–‡ç»ç ”ç©¶é ˜åŸŸé‚è¼¯ã€‚

**Decision**: æ¡ç”¨ Domain-Driven Design (DDD) + Onion Architectureã€‚

**Rationale**:
- é ˜åŸŸé‚è¼¯ï¼ˆæ–‡ç»æœå°‹ã€å¼•ç”¨åˆ†æï¼‰èˆ‡åŸºç¤è¨­æ–½ï¼ˆNCBI APIã€å¿«å–ï¼‰åˆ†é›¢
- æ˜“æ–¼æ¸¬è©¦ï¼šDomain Layer ä¸ä¾è³´å¤–éƒ¨æœå‹™
- æ˜“æ–¼æ“´å±•ï¼šæ–°å¢å·¥å…·åªéœ€åœ¨ Application Layer æ·»åŠ 

### ADR-002: é¸æ“‡ Nginx ä½œç‚º HTTPS åå‘ä»£ç†

**Context**: éœ€è¦ç‚ºç”Ÿç”¢ç’°å¢ƒæä¾› TLS åŠ å¯†å’Œå®‰å…¨é˜²è­·ã€‚

**Decision**: ä½¿ç”¨ Nginx ä½œç‚ºåå‘ä»£ç†ï¼Œè€Œéåœ¨ Python æ‡‰ç”¨ä¸­ç›´æ¥è™•ç† HTTPSã€‚

**Rationale**:
- Nginx å° TLS çµ‚æ­¢æœ‰æ›´å¥½çš„æ€§èƒ½
- SSE é•·é€£æ¥éœ€è¦ç‰¹æ®Šé…ç½®ï¼ˆ24h timeout, buffering offï¼‰
- Rate limiting åœ¨ Nginx å±¤é¢æ›´é«˜æ•ˆ
- å®‰å…¨æ¨™é ­çµ±ä¸€ç®¡ç†

### ADR-003: Citation Tree æ”¯æ´å¤šè¼¸å‡ºæ ¼å¼

**Context**: ä¸åŒç”¨æˆ¶æœ‰ä¸åŒçš„è¦–è¦ºåŒ–å·¥å…·åå¥½ã€‚

**Decision**: æ”¯æ´ 6 ç¨®è¼¸å‡ºæ ¼å¼ï¼šmermaid, cytoscape, g6, d3, vis, graphmlã€‚

**Rationale**:
- Mermaid: VS Code å…§å»ºé è¦½ï¼Œé›¶é…ç½®
- Cytoscape: å­¸è¡“ç•Œæ¨™æº–ï¼Œç”Ÿç‰©è³‡è¨Šå¸¸ç”¨
- GraphML: æ¡Œé¢è»Ÿé«”ï¼ˆGephi, VOSviewerï¼‰ç›¸å®¹
- ä¿æŒæ ¼å¼è½‰æ›é‚è¼¯ç¨ç«‹ï¼Œä¾¿æ–¼æ–°å¢æ ¼å¼

### ADR-004: Smart Citation Search è¨­è¨ˆ (è¦åŠƒä¸­)

**Context**: Agent åˆ¤æ–·æ–‡ç« ç›¸é—œæ€§æ¶ˆè€—å¤§é‡ tokenï¼Œéœ€è¦è®“ MCP é å…ˆæ’åºã€‚

**Decision**: æ•´åˆé è¨ˆç®— APIï¼ˆCitation Intentã€Conceptsã€Similarityï¼‰å¯¦ç¾ `smart_citation_search`ã€‚

**Rationale**:
- **Agent æ˜¯ç“¶é ¸**: MCP æ‡‰åšã€Œæ•¸æ“šå¯†é›†ã€å·¥ä½œï¼ŒAgent åšã€Œåˆ¤æ–·å¯†é›†ã€æ±ºç­–
- **Token ç¯€çœ**: 100 ç¯‡ Ã— 400 tokens â†’ 10 ç¯‡ Ã— 200 tokens = 95% ç¯€çœ
- **é è¨ˆç®—å„ªå…ˆ**: ä½¿ç”¨ Semantic Scholar Citation Intentã€OpenAlex Concepts ç­‰é è¨ˆç®—æŒ‡æ¨™

**è¨­è¨ˆåŸå‰‡**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Smart Citation Search è·è²¬åˆ†é›¢                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚           MCP è·è²¬ (æ•¸æ“šå¯†é›†)          â”‚                                 â”‚
â”‚  â”‚  â€¢ å¤šæºæœå°‹ (PubMed, S2, OpenAlex)     â”‚                                 â”‚
â”‚  â”‚  â€¢ å‘¼å«é è¨ˆç®— API                      â”‚                                 â”‚
â”‚  â”‚  â€¢ ä¾æŒ‡æ¨™æ’åº                          â”‚                                 â”‚
â”‚  â”‚  â€¢ è¼¸å‡º compact æ ¼å¼                   â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                          â†“                                                   â”‚
â”‚                    Top K çµæœ + æ’åºç†ç”±                                     â”‚
â”‚                          â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚  â”‚          Agent è·è²¬ (åˆ¤æ–·å¯†é›†)         â”‚                                 â”‚
â”‚  â”‚  â€¢ é–±è®€ç²¾é¸çµæœ                        â”‚                                 â”‚
â”‚  â”‚  â€¢ æ±ºå®šæ˜¯å¦éœ€è¦æ›´å¤š                    â”‚                                 â”‚
â”‚  â”‚  â€¢ ç¶œåˆåˆ†æèˆ‡å›ç­”                      â”‚                                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ADR-005: ç›¸ä¼¼åº¦åˆ†æ•¸ä¾†æºç­–ç•¥ (è¦åŠƒä¸­)

**Context**: `unified_search` éœ€è¦è¿”å›ç›¸ä¼¼åº¦åˆ†æ•¸ï¼Œä½†ä¸åŒä¾†æºæä¾›ä¸åŒçš„ç›¸ä¼¼åº¦è¨ˆç®—ã€‚

**Decision**: æ¡ç”¨å¤šä¾†æºç›¸ä¼¼åº¦èåˆç­–ç•¥ã€‚

**ä¾†æºå„ªå…ˆé †åº**:
1. **Semantic Scholar** (æœ‰ S2 ID) - åŸºæ–¼ citation graph çš„ç›¸ä¼¼åº¦
2. **Europe PMC** (æœ‰ PMID) - åŸºæ–¼ PubMed çš„ Related Articles æ¼”ç®—æ³•
3. **OpenAlex** (æœ‰ Works ID) - åŸºæ–¼ Concepts é‡ç–Šåº¦
4. **TF-IDF** (å‚™ç”¨) - åŸºæ–¼ title + abstract çš„æ–‡æœ¬ç›¸ä¼¼åº¦

**Rationale**:
- API æä¾›çš„ç›¸ä¼¼åº¦æ¯”æœ¬åœ°è¨ˆç®—æ›´æº–ç¢ºï¼ˆè€ƒæ…®äº† citation graph å’Œèªç¾©ï¼‰
- å¤šä¾†æºèåˆæé«˜ coverage
- TF-IDF ä½œç‚º fallback ç¢ºä¿ç¸½æ˜¯æœ‰ç›¸ä¼¼åº¦åˆ†æ•¸

**è¼¸å‡ºæ ¼å¼**:
```json
{
  "pmid": "12345678",
  "similarity_score": 0.87,
  "similarity_source": "semantic_scholar",
  "similarity_methods": {
    "semantic_scholar": 0.87,
    "europe_pmc": 0.82,
    "concept_overlap": 0.75
  }
}
```

---

## æ™ºèƒ½å¼•ç”¨ç³»çµ±æ¶æ§‹ (è¦åŠƒä¸­)

### 5 å€‹é è¨ˆç®— API æ•´åˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Pre-computed Intelligence APIs                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Semantic Scholar    â”‚    â”‚ OpenAlex            â”‚    â”‚ PubTator        â”‚  â”‚
â”‚  â”‚ Citation Intent     â”‚    â”‚ Concepts            â”‚    â”‚ Central         â”‚  â”‚
â”‚  â”‚                     â”‚    â”‚                     â”‚    â”‚                 â”‚  â”‚
â”‚  â”‚ â€¢ background        â”‚    â”‚ â€¢ Topic tags        â”‚    â”‚ â€¢ Gene          â”‚  â”‚
â”‚  â”‚ â€¢ methodology       â”‚    â”‚ â€¢ Level 0-3         â”‚    â”‚ â€¢ Disease       â”‚  â”‚
â”‚  â”‚ â€¢ result            â”‚    â”‚ â€¢ Score 0-1         â”‚    â”‚ â€¢ Chemical      â”‚  â”‚
â”‚  â”‚ â€¢ comparison        â”‚    â”‚                     â”‚    â”‚ â€¢ Mutation      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚             â”‚                          â”‚                        â”‚            â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                        â–¼                                     â”‚
â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚             â”‚              Smart Ranker                         â”‚            â”‚
â”‚             â”‚                                                   â”‚            â”‚
â”‚             â”‚  Weights (configurable by research_goal):         â”‚            â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚            â”‚
â”‚             â”‚  â”‚ methodology goal:                         â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Citation Intent (methodology): 40%    â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ RCR: 25%                              â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Concept Overlap: 20%                  â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Recency: 15%                          â”‚   â”‚            â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚
â”‚             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚            â”‚
â”‚             â”‚  â”‚ evidence goal:                            â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Citation Intent (result): 35%         â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Study Type (RCT > Cohort): 30%        â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ RCR: 20%                              â”‚   â”‚            â”‚
â”‚             â”‚  â”‚   â€¢ Recency: 15%                          â”‚   â”‚            â”‚
â”‚             â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚            â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                        â”‚                                     â”‚
â”‚                                        â–¼                                     â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚                          â”‚    Ranked Results        â”‚                        â”‚
â”‚                          â”‚    (compact format)      â”‚                        â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OpenCitations       â”‚                           â”‚ Europe PMC          â”‚  â”‚
â”‚  â”‚                     â”‚                           â”‚ Similar Articles    â”‚  â”‚
â”‚  â”‚ â€¢ DOI â†’ citations   â”‚                           â”‚                     â”‚  â”‚
â”‚  â”‚ â€¢ Citation timeline â”‚                           â”‚ â€¢ Similarity score  â”‚  â”‚
â”‚  â”‚ â€¢ Reference graph   â”‚                           â”‚ â€¢ Related by contentâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æª”æ¡ˆçµæ§‹è¦åŠƒ

```
src/pubmed_search/
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ ncbi/
â”‚   â”‚   â”œâ”€â”€ pubtator.py               # ğŸ†• PubTator Central å®¢æˆ¶ç«¯
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ sources/
â”‚       â”œâ”€â”€ opencitations.py          # ğŸ†• OpenCitations å®¢æˆ¶ç«¯
â”‚       â”œâ”€â”€ semantic_scholar.py       # âœï¸ æ“´å±• Citation Intent
â”‚       â”œâ”€â”€ openalex.py               # âœï¸ æ“´å±• Concepts API
â”‚       â””â”€â”€ europe_pmc.py             # âœï¸ æ“´å±• Similar Articles
â”œâ”€â”€ application/
â”‚   â””â”€â”€ search/
â”‚       â”œâ”€â”€ smart_ranker.py           # ğŸ†• æ™ºèƒ½æ’åºå™¨
â”‚       â””â”€â”€ result_aggregator.py      # âœï¸ æ“´å±•ç›¸ä¼¼åº¦èåˆ
â””â”€â”€ presentation/
    â””â”€â”€ mcp_server/
        â””â”€â”€ tools/
            â””â”€â”€ smart_citation.py     # ğŸ†• smart_citation_search å·¥å…·
```
